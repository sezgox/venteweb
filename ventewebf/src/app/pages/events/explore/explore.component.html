<app-header></app-header>

<div class="p-2">
        <!-- Search Bar -->
      <div class="mb-2 flex gap-4 justify-between items-center">
        <button
          class="flex items-center gap-2 px-3 py-2 rounded-lg border-2 border-gray300 bg-bg
                text-text font-medium transition-all hover:border-primary hover:text-primary
                text-sm md:text-base"
          style="anchor-name: --filter-btn"
          popovertarget="filters-modal"
          popovertargetaction="show"
          (click)="snapshotFilter(filter)"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
          </svg>
          <span>Filters</span>
        </button>

        <!-- Encima de los filtros existentes -->
        <button
          class="flex items-center gap-2 px-4 py-2 rounded-lg border-2 border-primary bg-primary text-white font-medium transition-all hover:bg-primary-dark"
          (click)="changeView()">
          @if(viewMap){
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path> <path d="M16 8L14 14L8 16L10 10L16 8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
          }@else {
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
          </svg>
          }
          <span>{{ viewMap ? 'Explore' : 'View on Map'}}</span>
        </button>

      </div>

      @if(viewMap){
        <div class="relative w-full h-[70vh] md:h-[600px]">
          <button class="btn-secondary absolute top-4 left-4 md:left-16 z-10 " (click)="findOnMap()">
            Find here
          </button>
          <div id="map" class="w-full h-full"></div>
        </div>
      }
      @else{
        <div class="mt-2">
          <h4 class="font-bold text-text text-2xl">{{selectedSection}}</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4 md:gap-8 auto-rows-fr mt-4">
              @for(event of events(); track $index){
                <app-event-card [event]="event"></app-event-card>
              }@empty{
                <p>No events found</p>
              }
            </div>
        </div>
      }

      @if(loading){
        <app-loading></app-loading>
      }
</div>


<!-- Filtros Modal -->
<div popover id="filters-modal" class="m-0 p-0 border-0 max-w-none md:max-w-[50vw] max-h-none bg-bg shadow-[0_0_5px] shadow-gray100 mt-2" >


      <!-- Header -->
      <div class="sticky top-0 bg-bg border-b border-gray200 px-6 py-4 flex justify-between items-center">
        <h3 class="text-xl font-bold text-text">Filters</h3>
        <button popovertarget="filters-modal" popovertargetaction="hide" (click)="onCancelFilter()" class="p-2 hover:bg-gray100 rounded-lg transition-colors">
          <svg class="w-6 h-6 text-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>


      <!-- Contenido vacÃ­o -->
    <div class="pt-6 px-6 space-y-4">

    <div class="relative w-full md:max-w-[70vw]">
      <input [(ngModel)]="filter.search"
        type="text"
        placeholder="Search events by name, location, or description..."
        class="w-full md:w-[50%] focus:w-full px-4 py-3 pl-12 rounded-lg border-2 border-gray200 bg-bg text-text focus:outline-none focus:border-primary transition-all"
      >
      <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
      </svg>
    </div>

      <!-- Rango de distancia -->
      @if(!viewMap){
        <div class="bg-gray50 p-4 rounded-lg border border-gray200">
          <label class="block text-sm font-semibold text-text mb-2">Distance Range</label>
          <div class="flex items-center gap-4">
            <input
              type="range"
              min="0"
              max="100"
              step="5"
              [value]="filter.radius"
              [(ngModel)]="filter.radius"
              class="flex-1 h-2 bg-gray200 rounded-lg appearance-none cursor-pointer accent-primary"
            >
            <span class="text-text font-semibold min-w-[60px] text-right">{{ filter.radius }} km</span>
          </div>
        </div>
      }

      <!-- Time chips -->
      <div>
        <label class="block text-sm font-semibold text-text mb-2">When</label>
        <div class="flex flex-wrap gap-2">
          <button
            class="px-4 py-2 rounded-full border-2 font-medium transition-all"
            [ngClass]="{
              'border-primary bg-primary text-white': filter.endDate === undefined,
              'border-gray300 bg-bg text-text hover:border-primary hover:text-primary': filter.endDate != undefined
            }"
            data-time="any"
            (click)="changeDateRange($event)"
          >
            â° Anytime
          </button>

          <button
            class="px-4 py-2 rounded-full border-2 font-medium transition-all"
            [ngClass]="{
              'border-primary bg-primary text-white': filter.endDate == today,
              'border-gray300 bg-bg text-text hover:border-primary hover:text-primary': filter.endDate !== today
            }"
            data-time="today"
            (click)="changeDateRange($event)"
          >
            ğŸ“… Today
          </button>

          <button
            class="px-4 py-2 rounded-full border-2 font-medium transition-all"
            [ngClass]="{
              'border-primary bg-primary text-white': filter.endDate === week,
              'border-gray300 bg-bg text-text hover:border-primary hover:text-primary': filter.endDate !== week
            }"
            data-time="week"
            (click)="changeDateRange($event)"
          >
            ğŸ“† This week
          </button>

          <button
            class="px-4 py-2 rounded-full border-2 font-medium transition-all"
            [ngClass]="{
              'border-primary bg-primary text-white': filter.endDate === month,
              'border-gray300 bg-bg text-text hover:border-primary hover:text-primary': filter.endDate !== month
            }"
            data-time="month"
            (click)="changeDateRange($event)"
          >
            ğŸ—“ï¸ This month
          </button>
        </div>
      </div>

      <!-- Visibility filter -->
      <div>
        <label class="block text-sm font-semibold text-text mb-2">Visibility</label>
        <div class="flex flex-wrap gap-2">
          <button
            class="px-4 py-2 rounded-full border-2 font-medium transition-all hover:bg-primary-hover"
            [ngClass]="{
              'border-primary bg-primary text-white': filter.visibility === 'Public',
              'border-gray300 bg-bg text-text hover:border-primary hover:text-primary': filter.visibility !== 'Public'
            }"
            (click)="filter.visibility = visibilities.Public"
          >
            ğŸŒ Public
          </button>

          <button
            class="px-4 py-2 rounded-full border-2 font-medium transition-all hover:bg-primary-hover"
            [ngClass]="{
              'border-primary bg-primary text-white': filter.visibility === 'Private',
              'border-gray300 bg-bg text-text hover:border-primary hover:text-primary': filter.visibility !== 'Private'
            }"
            (click)="filter.visibility = visibilities.Private"
          >
            ğŸ”’ Private
          </button>

          <button
            class="px-4 py-2 rounded-full border-2 font-medium transition-all hover:bg-primary-hover"
            [ngClass]="{
              'border-primary bg-primary text-white': filter.visibility == undefined,
              'border-gray300 bg-bg text-text hover:border-primary hover:text-primary': filter.visibility !== undefined
            }"
            (click)="filter.visibility = undefined"
          >
            ğŸ”„ Any
          </button>
        </div>
      </div>

      <!-- Looking for collaborators -->
      <div>
        <label class="flex items-center gap-3 cursor-pointer bg-gray50 p-4 rounded-lg border-2 border-gray200 hover:border-primary transition-colors">
          <input type="checkbox" class="w-5 h-5 rounded accent-primary cursor-pointer" [(ngModel)]="filter.collaboration">
          <span class="text-text font-medium">ğŸ™‹ Looking for collaborators</span>
        </label>
      </div>

      <!-- Categories -->
      <div class="mb-4 ">
        <label class="block text-sm font-semibold text-text mb-2">Categories</label>
        <div class="flex flex-wrap gap-2">
          @for(cat of categories; track $index){
            <button
              class="px-4 py-2 rounded-full border-2 font-medium transition-all hover:scale-105"
              [ngClass]="{
                'border-primary bg-primary text-white': filter.category === cat,
                'border-gray300 bg-bg text-text hover:border-primary hover:text-primary': filter.category !== cat
              }"
              (click)="selectCategory(cat)"
            >
              {{ cat }}
            </button>
          }
        </div>

    </div>

      <!-- Footer con botones -->
      <div class="sticky bottom-0 bg-bg border-t border-gray200 px-6 py-4 flex gap-3 mt-auto">
        <button class="px-4 py-2 text-gray600 font-medium hover:text-primary transition-colors flex-1" (click)="onClearFilter()">
          Clear
        </button>
        <button popovertarget="filters-modal" popovertargetaction="hide" class="btn-other flex-1" (click)="onCancelFilter()">
          Cancel
        </button>
        <button class="btn-primary flex-1" (click)="onApplyFilter()" popovertarget="filters-modal" popovertargetaction="hide">
          Apply
        </button>
      </div>

    </div>
</div>
